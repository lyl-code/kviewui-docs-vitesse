import{r as e,u as a,k as r,l as t,e as o,i,c as s,d as l,w as d,f as n,m as c,q as u,s as m,t as p,j as g}from"./index.4769b127.js";import{_ as y}from"./kui-icons.3c452229.js";import{g as h}from"./element.bd39bbbe.js";import{_ as f}from"./_plugin-vue_export-helper.cdc0426e.js";const k={src:{type:String,default:""},width:{type:String,default:"100%"},height:{type:String,default:""},mode:{type:String,default:""},fadeShow:{type:Boolean,default:!0},delay:{type:Number,default:1e3},radius:{type:Number,default:0},scale:{type:Number,default:1},error:{type:Boolean,default:!1},loading:{type:Boolean,default:!0},preview:{type:Boolean,default:!1},lazyload:{type:Boolean,default:!1}},w=e=>e.endsWith("px")?"px":e.endsWith("rpx")?"rpx":e.endsWith("rem")?"rem":"",S=e=>e.split(w(e))[0];var b;const x=f({name:"kui-image",props:k,emits:["click","previewImageSuccess","previewImageFail"],setup(o,i){const s=e({animateShow:o.fadeShow,loadError:!1,loading:o.loading,iconSize:100,slotLoading:a().loading,slotError:a().error,src:o.src,lazyloaded:!1}),l=h();o.delay&&setTimeout((()=>{s.loadError=!1,s.animateShow=!1}),o.delay);let d=0;return uni.getImageInfo({src:o.src,success:e=>{d=e.height,s.loading=!1}}),setTimeout((()=>{(()=>{o.src;const e=o.height;if(e)if("px"===w(e))s.iconSize=S(e);else{const a=S(e);s.iconSize=a/2}else s.iconSize=d})()}),800),r((()=>{setTimeout((()=>{o.lazyload&&(b=uni.createIntersectionObserver(this)).relativeToViewport({bottom:0}).observe(`.${l}`,(e=>{e.intersectionRatio>0?s.loading=!1:e.intersectionRatio<=0&&(s.loading=!0)}))}),1e3)})),t((()=>{b.disconnect()})),{props:o,data:s,elId:l,onLoadSuccess:e=>{setTimeout((()=>{s.loadError=!1,s.loading=!!o.lazyload,s.animateShow=!1}),o.delay)},onLoadError:e=>{s.loadError=!0},onClick:e=>{o.preview?uni.previewImage({urls:[o.src],current:0,success:e=>{i.emit("previewImageSuccess",e)},fail:e=>{i.emit("previewImageFail",e)}}):i.emit("click")}}}},[["render",function(e,a,r,t,h,f){const k=p,w=o(i("kui-icons"),y),S=g;return s(),l(S,{class:c(["kui-leading-none",t.elId])},{default:d((()=>[n(k,{src:e.src,style:{width:"0px",height:"0px"},onLoad:t.onLoadSuccess,onError:t.onLoadError},null,8,["src","onLoad","onError"]),t.data.loading||e.error?(s(),l(S,{key:0,class:c(["kui-bg-gray-200 kui-flex kui-flex-col kui-justify-center kui-items-center",t.data.animateShow?"kui-animate-pulse":""]),style:u({width:e.width,height:e.height,borderRadius:`${e.radius}rpx`})},{default:d((()=>[n(w,{type:"image",size:Number(t.data.iconSize),class:"kui-text-gray-300"},null,8,["size"])])),_:1},8,["class","style"])):m("",!0),t.data.loading||!t.data.src||e.mode||e.error?m("",!0):(s(),l(k,{key:1,src:t.data.src,style:u({width:e.width,height:e.height,borderRadius:`${e.radius}rpx`,transform:`scale(${e.scale})`}),onClick:t.onClick},null,8,["src","style","onClick"])),!t.data.loading&&t.data.src&&e.mode?(s(),l(k,{key:2,src:t.data.src,mode:e.mode,style:u({borderRadius:`${e.radius}rpx`,transform:`scale(${e.scale})`}),onClick:t.onClick},null,8,["src","mode","style","onClick"])):m("",!0)])),_:1},8,["class"])}],["__scopeId","data-v-77ac97c8"]]);export{x as _};
